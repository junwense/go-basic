详细方案设计
1。如何判断服务商崩溃
    有2种判断方式
    响应时间，如果是99线的响应时间已经比正常的响应时间长的1.5-2倍的时间，这个时候就需要考虑更换节点，
    非业务，业务的响应错误，这里非业务指（超时，请求错误 ，返回错误，eof错误），业务错误即（对方系统业务设计的系统内部错误之类的）
    根据错误，可以通过时间窗口来判断某段时间的错误是否到20%。

2。如果切换服务商，这里在调用的时候就需要维护一个service，service里面维护各个服务商的权重关系，然后定时任务检查服务商的以上2个指标，
    通过指标来控制服务商的权重，如果是动态权重，则在出现错误的情况来直接修改，但是这样比较难直接关闭某服务，做成异步控制的比较灵活

3。同步转异步
    这里比较恶心的问题是请求的响应和返回的响应如果都过大，这个时候，数据库很难做到格式化存储。这里考虑采用mangodb这种非关系型数据库
来保存请求的数据（为什么不引入db，在引入mangodb，因为如果把业务数据放到数据库里是方便查询，但是这样会加剧分布式事务的问题）。这里
一定要先保障数据记录到mangodb成功（事务成功），再发送短信邮件，在短信邮件处理完成过后，把数据结果更新到mangodb里面。
    如果机器宕机了或者需要数据异步处理，则直接等需要唤醒到时候，检查mangodb里面符合要求，未完成到数据，读取数据后再进行发送流程。
    （服务重试可以采取间隔一定时间到重试检测，如果检测几次成功，就恢复此服务商权重，并且重新处理缓存的数据）
    这里注意，一定要设计兜底到流程，比如数据到一定次数就直接算失败，然后告警，或者是超过一定时间直接算失败。

4。其他问题
    没有引入异步接口，直接采用同步接口，内部通过这种同步转异步的方式，会导致业务方再调用上会有行为上的不一致，或者说业务方就要求
同步返回数据（因为是调用同步接口），这个时候，只能返回兜底的默认值，就会有一些争议，这种是设计成异步的接口来解决比较合适。
    如果服务商时好时坏，可能会导致本地的保存消息超时（本地转异步存取的数据肯定是存在一定的时间限制的，不然如果别人调用你接口，你12
小时后那会数据，对调用方来说没有任何意义），这样会导致消息总处理不完，最后恶性循环，这个时候要评估服务商的处理性能，做好限流，同
步转异步已经不能解决问题来。
    mangodb需要做到高可用，如果这个步骤失败了，是否允许继续调用服务商？这个无疑增加了系统的复杂度，降低了可用性，也就是说，非必要的
业务，没必要采取这种方案。
    
    